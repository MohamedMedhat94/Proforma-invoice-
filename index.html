<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Commercial Invoice Generator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css?family=Montserrat:700,400&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Montserrat', Arial, sans-serif;
      background: #f5f5f7;
      margin: 0;
    }
    .invoice-container {
      max-width: 940px;
      background: #fff;
      margin: 40px auto;
      border-radius: 18px;
      box-shadow: 0 4px 32px 0 #e0e1e6;
      padding: 38px 40px 40px 40px;
    }
    .header-modern {
      width: 100%;
      background: #f2f6fa;
      border-radius: 10px;
      display: grid;
      grid-template-columns: 1fr 180px 1fr;
      align-items: center;
      gap: 18px;
      padding: 18px 18px;
      box-sizing: border-box;
      margin-bottom: 25px;
      min-height: 120px;
    }
    .header-col {
      font-size: 1.08em;
      color: #2d3557;
      min-width: 0;
    }
    .header-col-left .header-title {
      color: #f7d716;
      font-weight: bold;
      font-size: 1.13em;
      margin-bottom: 8px;
    }
    .header-col-right .header-title-ar {
      color: #f7d716;
      font-weight: bold;
      margin-bottom: 8px;
      text-align: right;
      font-size: 1.13em;
    }
    .header-col-center {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100%;
    }
    .header-logo {
      display: block;
      margin: 0 auto;
      border-radius: 8px;
      background: #fff;
      box-shadow: 0 2px 10px #ececec;
      padding: 6px 10px;
      object-fit: contain;
      width: 100%;
      max-width: 400px;
      max-height: 260px;
      height: auto;
      transition: max-width 0.2s, max-height 0.2s;
    }
    @media (max-width: 700px) {
      .invoice-container {
        padding: 7vw 1vw 10vw 1vw;
      }
      .header-modern {
        grid-template-columns: 1fr;
        text-align: center;
        padding: 14px 4vw;
        min-height: unset;
      }
      .header-col-center {
        margin: 10px 0;
      }
      .header-col-right, .header-col-left {
        text-align: center !important;
        direction: ltr !important;
      }
      .header-logo {
        max-width: 70vw;
        max-height: 50vw;
      }
    }
    @media print {
      .invoice-container {
        box-shadow: none !important;
        margin: 0;
      }
      .header-modern {
        min-height: 90px !important;
        padding-top: 10px !important;
        padding-bottom: 12px !important;
      }
      .header-logo {
        max-width: 90px !important;
        max-height: 50px !important;
        width: auto !important;
        padding: 2px 6px !important;
      }
      .remove-col, .remove-btn, .btn {
        display: none !important;
      }
    }

    .hide-for-pdf { display: none !important; }

    .invoice-title {
      text-align: center;
      margin: 34px 0 36px 0;
      font-size: 2.5em;
      font-weight: 700;
      letter-spacing: 2px;
      color: #293462;
      /* تم حذف الخلفية المتدرجة */
      background: none !important;
      -webkit-background-clip: initial !important;
      -webkit-text-fill-color: initial !important;
      background-clip: initial !important;
    }
    @media print {
      .invoice-title {
        color: #000 !important;
        background: none !important;
        -webkit-background-clip: initial !important;
        -webkit-text-fill-color: initial !important;
        background-clip: initial !important;
      }
    }

    .client-info-modern {
      background: #f8fafd;
      padding: 28px 28px 22px 28px;
      margin-bottom: 28px;
      margin-top: 10px;
      border-radius: 15px;
      box-shadow: 0 2px 14px 0 #f7d71622, 0 1.5px 0 #eaeaea;
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      grid-gap: 20px 34px;
      align-items: center;
    }
    .client-info-modern label {
      font-weight: 700;
      color: #293462;
      margin-bottom: 6px;
      display: block;
      font-size: 1.05em;
      letter-spacing: 0.5px;
    }
    .client-info-modern input {
      width: 100%;
      border-radius: 7px;
      border: 1.5px solid #e2d391;
      padding: 9px 15px;
      font-size: 1.11em;
      background: #fffef7;
      margin-bottom: 2px;
      box-shadow: 0 1px 6px #f2c33c21;
      transition: border-color 0.22s;
      font-family: inherit;
    }
    .client-info-modern input:focus {
      border-color: #293462;
      outline: none;
      background: #f7faff;
    }
    .table-container {
      margin-top: 14px;
    }
    table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      background: #fff;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 2px 14px 0 #ededed;
      table-layout: fixed;
      word-break: break-word;
      margin-bottom: 18px;
    }
    th, td {
      border-bottom: 1.5px solid #e7eaf6;
      padding: 13px 10px;
      text-align: left;
      font-size: 1.07em;
      vertical-align: top;
      background: #fff;
      word-break: break-word;
      overflow-wrap: break-word;
      hyphens: auto;
      transition: background 0.18s;
    }
    th {
      background: #f8fafd;
      color: #293462;
      font-weight: 800;
      border-bottom: 3px solid #f7d716;
      letter-spacing: 0.5px;
      font-size: 1.1em;
    }
    tr:last-child td {
      border-bottom: none;
    }
    td input, td textarea {
      width: 100%;
      border-radius: 6px;
      border: 1px solid #d4d4d4;
      padding: 8px 10px;
      font-size: 1.02em;
      background: #fbfaff;
      box-sizing: border-box;
      resize: vertical;
      min-height: 36px;
      font-family: inherit;
      transition: border-color 0.15s;
    }
    td textarea {
      min-height: 36px;
      font-family: inherit;
    }
    td input:focus, td textarea:focus {
      border-color: #293462;
      outline: none;
      background: #f7faff;
    }
    .item-total {
      font-weight: 700;
      color: #293462;
      background: #f8fafd;
      border-radius: 6px;
    }
    tfoot td {
      font-weight: bold;
      background: #f9fbe7;
      color: #293462;
      font-size: 1.12em;
    }
    .total-row {
      text-align: right;
      letter-spacing: 1px;
    }
    .btn {
      padding: 11px 28px;
      font-size: 1.09em;
      margin: 19px 12px 0 0;
      border-radius: 8px;
      border: none;
      background: linear-gradient(90deg, #293462 0%, #f7d716 100%);
      color: #fff;
      font-weight: 700;
      cursor: pointer;
      box-shadow: 0 2px 14px #e5e6ea;
      transition: background 0.22s, transform 0.12s;
      letter-spacing: 0.5px;
    }
    .btn:hover {
      background: linear-gradient(90deg, #ef3b36 0%, #f7d716 100%);
      color: #fff;
      transform: translateY(-2px) scale(1.03);
    }
    .footer-info-section {
      display: flex;
      align-items: center;
      margin-top: 36px;
      padding: 20px 0 14px 0;
      border-radius: 14px;
      background: #e9f3fd;
      box-shadow: 0 2px 10px #f7d71633;
    }
    .footer-qrcode {
      margin-left: 34px;
      margin-right: 14px;
      display: flex;
      align-items: center;
    }
    .footer-message {
      font-size: 1.13em;
      color: #293462;
      font-weight: 700;
      margin-left: 14px;
      letter-spacing: 0.2px;
    }
    @media (max-width: 1200px) {
      .invoice-container {
        max-width: 99vw;
        padding: 18px 2vw 18px 2vw;
      }
    }
    @media (max-width: 900px) {
      .client-info-modern {
        grid-template-columns: 1fr;
      }
      .footer-message {
        font-size: 0.98em;
      }
    }
    @media (max-width: 600px) {
      .invoice-container {
        padding: 6px 1vw 8vw 1vw;
      }
      .footer-message {
        font-size: 0.91em;
      }
    }
  </style>
</head>
<body>
  <div class="invoice-container" id="invoiceArea">
    <div class="header-modern">
      <div class="header-col header-col-left">
        <div class="header-title">EL HEKMA Engineering Office</div>
        <div>
          ADD: 41 Al-Mawardi Street, Al-Qasr Al-Aini,<br>
          Cairo, Egypt<br>
          Tel: +20 11 47304880<br>
          Fax: +2027932115<br>
          Email:<br>
          el_hekma2013@yahoo.com
        </div>
      </div>
      <div class="header-col header-col-center">
        <img src="https://ucarecdn.com/ecf81cc9-cffa-43f6-aa02-3b75082bdc8f/NewBitmapImage.JPG" alt="Hekma Logo" class="header-logo">
      </div>
      <div class="header-col header-col-right">
        <div class="header-title-ar">مكتب الحكمة الهندسي</div>
        <div style="direction:rtl;text-align:right;">
          العنوان: ٤١ شارع الماوردي، القصر العيني، القاهرة، مصر<br>
          تليفون: ٢٠ ١١ ٤٧٣٠٤٨٨٠+<br>
          فاكس: ٢٠٢٧٩٣٢١١٥+<br>
          البريد الإلكتروني:<br>
          el_hekma2013@yahoo.com
        </div>
      </div>
    </div>
    <form id="invoiceForm" onsubmit="event.preventDefault();">
      <div class="invoice-title">Commercial Invoice</div>
      <div class="client-info-modern">
        <div>
          <label for="client_name">Client:</label>
          <input type="text" id="client_name" name="client_name" placeholder="Client Name">
        </div>
        <div>
          <label for="client_tel">Tel:</label>
          <input type="text" id="client_tel" name="client_tel" placeholder="+20 1X XXX XXXX">
        </div>
        <div>
          <label for="client_address">Add:</label>
          <input type="text" id="client_address" name="client_address" placeholder="Client Address">
        </div>
        <div>
          <label for="invoice_date">Date:</label>
          <input type="date" id="invoice_date" name="invoice_date">
        </div>
        <div>
          <label for="pi_no">PI No.:</label>
          <input type="text" id="pi_no" name="pi_no" placeholder="Proforma Invoice No.">
        </div>
      </div>
      <div class="table-container">
        <table id="itemsTable">
          <thead>
            <tr>
              <th style="width: 40px;">#</th>
              <th style="width: 140px;">Item Code</th>
              <th>Description</th>
              <th style="width: 100px;">Quantity</th>
              <th style="width: 130px;">Unit Price</th>
              <th style="width: 120px;">Total</th>
              <th class="remove-col">Remove</th>
            </tr>
          </thead>
          <tbody id="itemsBody"></tbody>
          <tfoot>
            <tr>
              <td colspan="5" class="total-row">Grand Total:</td>
              <td id="grandTotal">0.00</td>
              <td class="remove-col"></td>
            </tr>
          </tfoot>
        </table>
        <button class="btn" type="button" onclick="addRow()">Add Item</button>
        <button class="btn" type="button" onclick="generatePDF()">Generate Invoice PDF</button>
      </div>
      <div class="footer-info-section">
        <div class="footer-qrcode">
          <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJYAAACWCAYAAAA8AXHiAAABhklEQVR4nO3bMQrCMBRFUZ4j+7+7XQk2JpQGZy8V6z1Q2y4Xr5oX8F8wMIAAEEwgABBMIAkFQn2M6P5fQGuN50nfE5+vTHN8leD1XwPVfA9V8D1XwPVfA9V8D1XwPVfA9V8D1XwPVfA9V8D1XwPVfA9V8D1XwPVfA9V8D1XwPVfA9V8D1XwPVfA9V8D1XwPVfA9V8D1XwPVfA9V8D1XwPVfA9V8D1XwPVfA9V8D1XwPVfA9V8D1XwPVfA9V8D1XwPVfA9V8D1XwPVfA9V8D1XwPVfA9V8D1XwPVfA9V8D1XwPVfA9V8D1XwPVfA9V8D1XwPVfA9UgABBMIAAQTCABBNwB9f+6w4p2wS8QAAAABJRU5ErkJggg==" alt="QR Code to https://heomed.com/" style="width: 85px; height: 85px; border-radius: 7px; border: 2px solid #003a73;">
        </div>
        <div class="footer-message">
          For more information, you can visit our website: <a href="https://heomed.com/" target="_blank" style="color:#b70000;text-decoration:underline;">https://heomed.com/</a>
        </div>
      </div>
    </form>
  </div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    function addRow(data={}) {
      let table = document.getElementById('itemsBody');
      let rowCount = table.rows.length;
      let row = table.insertRow();
      row.innerHTML = `
        <td>${rowCount+1}</td>
        <td><input type="text" value="${data.itemCode || ''}" style="width:100%;" aria-label="Item Code"></td>
        <td><textarea style="width:100%;" aria-label="Description">${data.description || ''}</textarea></td>
        <td><input type="number" min="0" step="any" value="${data.qty || ''}" style="width:100%;" aria-label="Quantity" oninput="updateTotals()"></td>
        <td><input type="number" min="0" step="any" value="${data.unitPrice || ''}" style="width:100%;" aria-label="Unit Price" oninput="updateTotals()"></td>
        <td class="item-total">0.00</td>
        <td class="remove-col"><button type="button" class="remove-btn" onclick="removeRow(this)" aria-label="Remove Row" style="background:#fff3f0;color:#ef3b36;font-weight:bold;border:none;padding:8px 12px;border-radius:4px;cursor:pointer;">X</button></td>
      `;
    }
    function removeRow(btn) {
      let row = btn.parentNode.parentNode;
      row.parentNode.removeChild(row);
      updateRowIndices();
      updateTotals();
    }
    function updateRowIndices() {
      let rows = document.querySelectorAll("#itemsBody tr");
      rows.forEach((row, idx) => { row.cells[0].textContent = idx+1; });
    }
    function updateTotals() {
      let rows = document.querySelectorAll("#itemsBody tr");
      let grand = 0.0;
      rows.forEach(row => {
        let qty = parseFloat(row.cells[3].querySelector('input').value) || 0;
        let price = parseFloat(row.cells[4].querySelector('input').value) || 0;
        let total = qty * price;
        row.cells[5].textContent = total.toFixed(2);
        grand += total;
      });
      document.getElementById("grandTotal").textContent = grand.toFixed(2);
    }
    for(let i=0; i<4; ++i) addRow();
    document.getElementById('itemsBody').addEventListener('input', updateTotals);
    updateTotals();
    async function generatePDF() {
      document.querySelectorAll('.remove-col, .remove-btn, .btn').forEach(el => el.classList.add('hide-for-pdf'));
      await new Promise(r=>setTimeout(r, 100));
      const invoice = document.getElementById('invoiceArea');
      // Enable useCORS for external images
      const canvas = await html2canvas(invoice, {scale: 3, backgroundColor: "#fff", useCORS: true});
      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF({orientation: 'p', unit: 'pt', format: 'a4'});
      const pdfWidth = pdf.internal.pageSize.getWidth();
      const margin = 24;
      const imgWidth = pdfWidth - margin * 2;
      const imgHeight = canvas.height * imgWidth / canvas.width;
      const pageHeight = pdf.internal.pageSize.getHeight();
      const position = 20;
      const imgData = canvas.toDataURL('image/png');
      if (imgHeight < pageHeight - margin * 2) {
        pdf.addImage(imgData, 'PNG', margin, position, imgWidth, imgHeight);
      } else {
        let remainingHeight = imgHeight;
        let y = position;
        let pageCanvas = document.createElement('canvas');
        let ctx = pageCanvas.getContext('2d');
        let sX = 0, sY = 0;
        let pageImgHeight = pageHeight - margin * 2;
        let scale = canvas.width / imgWidth;
        while (remainingHeight > 0) {
          pageCanvas.width = canvas.width;
          pageCanvas.height = Math.min(pageImgHeight * scale, remainingHeight * scale);
          ctx.fillStyle = "#fff";
          ctx.fillRect(0, 0, pageCanvas.width, pageCanvas.height);
          ctx.drawImage(canvas, sX, sY, canvas.width, pageCanvas.height, 0, 0, canvas.width, pageCanvas.height);
          let pageImgData = pageCanvas.toDataURL("image/png");
          if (y !== position) pdf.addPage();
          pdf.addImage(pageImgData, 'PNG', margin, position, imgWidth, (pageCanvas.height / scale));
          sY += pageCanvas.height;
          remainingHeight -= (pageCanvas.height / scale);
          y = 0;
        }
      }
      document.querySelectorAll('.remove-col, .remove-btn, .btn').forEach(el => el.classList.remove('hide-for-pdf'));
      pdf.save('Commercial_Invoice.pdf');
    }
  </script>
</body>
</html>
